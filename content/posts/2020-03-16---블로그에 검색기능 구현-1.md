---
title: Gatsby 블로그에 검색기능 구현하기-1
date: "2020-03-16"
template: "post"
draft: true
slug: "/posts/gatsby-search"
category: "JS"
tags:
  - "javascript"
  - "Gatsby"
  - "Gatsby 검색기능"
  - "검색"
description: Gatsby 블로그에 검색기능을 만들어서 추가해보자!
---
<style>
  s{
    font-size:0.5em;
  }
</style>
 - [만들게 된 배경](#만들게-된-배경)
 - [Optional chaining in JavaScript](#optional-chaining-in-javascript)
 - [새로운 시험 기능](#새로운-시험-기능)
 - [시험 버전을 마친 기능](#시험버전을-마친-기능)
 - [기타 등등](#기타) 


# 만들게 된 배경

Gatsby로 블로그를 잘 작성하고 있는 중이다. 그런데 내가 예전에 썼던 블로그를 다시 찾아서 보려고 하니 여간 불편한게 아니다. 내가 다운받아서 만든 이 [Gatsby-starter-lumen](https://www.gatsbyjs.org/starters/alxshelepenok/gatsby-starter-lumen/)은 정말 마음에 드는 블로그 템플릿이지만 안타깝게도 검색기능이 없다. 검색 플러그인이 있나 찾아봤는데 총 3개 정도 있는 것 같다.

Gatsby 공식사이트에 나와있는 [Adding-Search](https://www.gatsbyjs.org/docs/adding-search/)에 들어가 보면 어떻게 플러그인을 설치해야 하는지 나와있고 Algolia, elasticlunr, js-search를 사용해서 어떻게 구현가능한지 설명해놓았다.
하지만 Algolia는 기업을 위한 전문 플러그인이고, elasticlunr는 참 좋지만, 한글을 지원하지 않는다. <s>일본어는 지원하면서</s>때문에 나는 공부도 할 겸해서 직접 구현하기로 했다.

 elasticLunr를 보면 받은 단어들을 토큰화하고 우선순위를 매겨서 빠르고 정확한 결과값을 보여준다. 하지만 나는 내가 직접 만들 것이고 검색을 하면 결과값을 보여주는 정도로만 만들어 놓았다. 만약 블로그 포스팅이 점점 더 많아진다면 내가 만든 검색기능은 적합하지 않을 것이다. 하지만 내 블로그 포스트들이 검색에 부담을 가질 정도로 늘어날 것 같지는 않을 것 같다.

# Gatsby가 데이터를 가져오는 과정 이해하기

Gatsby는 데이터를 어떻게 가져올까? Gatsby는 프레임워크로 이미 어느정도 다 구현이 된 Starter 템플릿을 제공한다. 
일단 Gatsby는 <strong>'정적 웹사이트 생성기'</strong>이다. 즉 그 안에서 사용하는 데이터들은 내가 만든 소스들에 있다. 여기에서 데이터들을 graphql을 이용하여 보여준다. 

`gatsby-config.js` 파일을 열어보면 플러그인을 비롯한 사이트의 기본설정들을 넣을 수 있는 것을 알 수 있다.



# Search Component 만들기

이제 어느 정도 이해를 했으면 Search Component를 만들어 보면 된다. 아래와 같이 **Component** 폴더 아래에 *Search* 디렉토리와 사용할 Search.js 파일을 만들어 준다. 

Search.js를 작성한다. 나는 좀 더 쉽고 예쁘게 만들기 위해 MDBRecat를 사용했다.

```js
/* 
Search.js 
*/

import React, { useState } from 'react';
import { MDBCol, MDBFormInline, MDBIcon } from 'mdbreact';
import styles from './Search.module.scss';

const Search = ()=>{

  const [state, setState] = useState({
      filteredData: [],
      query: emptyQuery,
  });

  const handleInputChange = event=>{
    const query = event.target.value;
      setState({
        query, 
        filteredData, 
      });
  }

 return (
   <div className={styles['search']}>
      <MDBCol md="12">
        <MDBFormInline className="md-form">
          <MDBIcon icon="search" />
          <input
            className="form-control form-control-sm ml-3 w-75"
            type="text"
            placeholder="Search"
            aria-label="Search"
            onChange={handleInputChange}
          />
        </MDBFormInline>
      </MDBCol>
    </div >
 )
}

export default Search

```

간단하게 설명하면 Basic한 Search 모듈이다. input값을 받을 수 있는 handleInputChange만 


# StaticQuery로 Graphql 데이터 가져오기 

Gatsby는 원래 Page 쿼리로만 데이터를 가지고 올 수 있었다. 그래서 만약 특정 컴포넌트에서 데이터를 가지고 오려고 한다면, Header나 Layout 등 감싸고 있는 컴포넌트에서 데이터를 받아서 props 형태로 전달해줘야 했다.
Gatsby v2 버전부터는 StaticQuery를 이용해 컴포넌트에서도 graphql로 데이터를 가지고 올 수 있다.
# Search 컴포넌트에 렌더링하기

# index-template에 Search 컴포넌트 import하기

# mdbreact로 스타일 적용하기